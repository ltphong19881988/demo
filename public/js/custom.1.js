var currencyPairArray = ["BTC_AMP","BTC_ARDR","BTC_BCH","BTC_BCN","BTC_BCY","BTC_BELA","BTC_BLK","BTC_BTCD","BTC_BTM","BTC_BTS","BTC_BURST","BTC_CLAM","BTC_CVC","BTC_DASH","BTC_DCR","BTC_DGB","BTC_DOGE","BTC_EMC2","BTC_ETC","BTC_ETH","BTC_EXP","BTC_FCT","BTC_FLDC","BTC_FLO","BTC_GAME","BTC_GAS","BTC_GNO","BTC_GNT","BTC_GRC","BTC_HUC","BTC_LBC","BTC_LSK","BTC_LTC","BTC_MAID","BTC_NAUT","BTC_NAV","BTC_NEOS","BTC_NMC","BTC_NOTE","BTC_NXC","BTC_NXT","BTC_OMG","BTC_OMNI","BTC_PASC","BTC_PINK","BTC_POT","BTC_PPC","BTC_RADS","BTC_REP","BTC_RIC","BTC_SBD","BTC_SC","BTC_SJCX","BTC_STEEM","BTC_STR","BTC_STRAT","BTC_SYS","BTC_VIA","BTC_VRC","BTC_VTC","BTC_XBC","BTC_XCP","BTC_XEM","BTC_XMR","BTC_XPM","BTC_XRP","BTC_XVC","BTC_ZEC","BTC_ZRX","ETH_BCH","ETH_CVC","ETH_ETC","ETH_GAS","ETH_GNO","ETH_GNT","ETH_LSK","ETH_OMG","ETH_REP","ETH_STEEM","ETH_ZEC","ETH_ZRX","USDT_BCH","USDT_BTC","USDT_DASH","USDT_ETC","USDT_ETH","USDT_LTC","USDT_NXT","USDT_REP","USDT_STR","USDT_XMR","USDT_XRP","USDT_ZEC","XMR_BCN","XMR_BLK","XMR_BTCD","XMR_DASH","XMR_LTC","XMR_MAID","XMR_NXT","XMR_ZEC"];
var currencyNamesArray = {"1CR":"1CRedit","ABY":"ArtByte","AC":"AsiaCoin","ACH":"Altcoin Herald","ADN":"Aiden","AEON":"AEON Coin","AERO":"Aerocoin","AIR":"AIRcoin","APH":"AphroditeCoin","AUR":"Auroracoin","AXIS":"Axis","BALLS":"Snowballs","BANK":"BankCoin","BBL":"BitBlock","BBR":"Boolberry","BCC":"BTCtalkcoin","BCN":"Bytecoin","BDC":"Black Dragon Coin","BDG":"Badgercoin","BELA":"Bela","BITS":"Bitstar","BLK":"BlackCoin","BLOCK":"Blocknet","BLU":"BlueCoin","BNS":"BonusCoin","BONES":"Bones","BOST":"BoostCoin","BTC":"Bitcoin","BTCD":"BitcoinDark","BTCS":"Bitcoin-sCrypt","BTM":"Bitmark","BTS":"BitShares","BURN":"BurnerCoin","BURST":"Burst","C2":"Coin2.0","CACH":"CACHeCoin","CAI":"CaiShen","CC":"Colbert Coin","CCN":"Cannacoin","CGA":"Cryptographic Anomaly","CHA":"Chancecoin","CINNI":"CinniCoin","CLAM":"CLAMS","CNL":"ConcealCoin","CNMT":"Coinomat1","CNOTE":"C-Note","COMM":"CommunityCoin","CON":"Coino","CORG":"CorgiCoin","CRYPT":"CryptCoin","CURE":"Curecoin","CYC":"Conspiracy Coin","DGB":"DigiByte","DICE":"NeoDICE","DIEM":"Diem","DIME":"Dimecoin","DIS":"DistroCoin","DNS":"BitShares DNS","DOGE":"Dogecoin","DASH":"Dash","DRKC":"DarkCash","DRM":"Dreamcoin","DSH":"Dashcoin","DVK":"DvoraKoin","EAC":"EarthCoin","EBT":"EBTcoin","ECC":"ECCoin","EFL":"Electronic Gulden","EMC2":"Einsteinium","EMO":"EmotiCoin","ENC":"Entropycoin","eTOK":"eToken","EXE":"Execoin","FAC":"Faircoin","FCN":"Fantomcoin","FIBRE":"Fibrecoin","FLAP":"FlappyCoin","FLDC":"FoldingCoin","FLT":"FlutterCoin","FOX":"FoxCoin","FRAC":"Fractalcoin","FRK":"Franko","FRQ":"FairQuark","FVZ":"FVZCoin","FZ":"Frozen","FZN":"Fuzon","GAP":"Gapcoin","GDN":"Global Denomination","GEMZ":"GetGems","GEO":"GeoCoin","GIAR":"Giarcoin","GLB":"Globe","GAME":"GameCredits","GML":"GameleagueCoin","GNS":"GenesisCoin","GOLD":"GoldEagles","GPC":"GROUPCoin","GPUC":"GPU Coin","GRCX":"Gridcoin","GRS":"Groestlcoin","GUE":"Guerillacoin","H2O":"H2O Coin","HIRO":"Hirocoin","HOT":"Hotcoin","HUC":"Huntercoin","HVC":"Heavycoin","HYP":"HyperStake","HZ":"Horizon","IFC":"Infinitecoin","ITC":"Information Coin","IXC":"iXcoin","JLH":"jl777hodl","JPC":"JackpotCoin","JUG":"JuggaloCoin","KDC":"KlondikeCoin","KEY":"KeyCoin","LC":"Limecoin","LCL":"Limecoin Lite","LEAF":"Leafcoin","LGC":"Logicoin","LOL":"LeagueCoin","LOVE":"LOVEcoin","LQD":"LIQUID","LTBC":"LTBCoin","LTC":"Litecoin","LTCX":"LiteCoinX","MAID":"MaidSafeCoin","MAST":"MastiffCoin","MAX":"MaxCoin","MCN":"Moneta Verde","MEC":"Megacoin","METH":"CryptoMETH","MIL":"Millennium Coin","MIN":"Minerals","MINT":"Mintcoin","MMC":"MemoryCoin","MMNXT":"MMNXT","MMXIV":"Maieuticoin","MNTA":"Moneta","MON":"Monocle","MRC":"microCoin","MRS":"Marscoin","OMNI":"Omni","MTS":"Metiscoin","MUN":"Muniti","MYR":"Myriadcoin","MZC":"MazaCoin","N5X":"N5coin","NAS":"NAS","NAUT":"Nautiluscoin","NAV":"NAVCoin","NBT":"NuBits","NEOS":"Neoscoin","NL":"Nanolite","NMC":"Namecoin","NOBL":"NobleCoin","NOTE":"DNotes","NOXT":"NobleNXT","NRS":"NoirShares","NSR":"NuShares","NTX":"NTX","NXT":"NXT","NXTI":"NXTInspect","OPAL":"Opal","PAND":"PandaCoin","PAWN":"Pawncoin","PIGGY":"New Piggycoin","PINK":"Pinkcoin","PLX":"ParallaxCoin","PMC":"Premine","POT":"PotCoin","PPC":"Peercoin","PRC":"ProsperCoin","PRT":"Particle","PTS":"BitShares PTS","Q2C":"QubitCoin","QBK":"Qibuck","QCN":"QuazarCoin","QORA":"Qora","QTL":"Quatloo","RBY":"Rubycoin","RDD":"Reddcoin","RIC":"Riecoin","RZR":"Razor","SDC":"Shadow","SHIBE":"ShibeCoin","SHOPX":"ShopX","SILK":"Silkcoin","SJCX":"Storjcoin X","SLR":"SolarCoin","SMC":"SmartCoin","SOC":"SocialCoin","SPA":"Spaincoin","SQL":"Squallcoin","SRCC":"SourceCoin","SRG":"Surge","SSD":"Sonic","STR":"Stellar","SUM":"SummerCoin","SUN":"Suncoin","SWARM":"SWARM","SXC":"Sexcoin","SYNC":"Sync","SYS":"Syscoin","TAC":"Talkcoin","TOR":"TorCoin","TRUST":"TrustPlus","TWE":"Twecoin","UIS":"Unitus","ULTC":"Umbrella-LTC","UNITY":"SuperNET","URO":"Uro","USDE":"USDE","USDT":"Tether USD","UTC":"UltraCoin","UTIL":"UtilityCoin","UVC":"UniversityCoin","VIA":"Viacoin","VOOT":"VootCoin","VRC":"VeriCoin","VTC":"Vertcoin","WC":"WhiteCoin","WDC":"Worldcoin","WIKI":"Wikicoin","WOLF":"InsanityCoin","X13":"X13Coin","XAI":"Sapience AIFX","XAP":"API Coin","XBC":"BitcoinPlus","XC":"XCurrency","XCH":"ClearingHouse","XCN":"Cryptonite","XCP":"Counterparty","XCR":"Crypti","XDN":"DigitalNote","XDP":"Dogeparty","XHC":"Honorcoin","XLB":"Libertycoin","XMG":"Magi","XMR":"Monero","XPB":"Pebblecoin","XPM":"Primecoin","XRP":"Ripple","XSI":"Stability Shares","XST":"StealthCoin","XSV":"Silicon Valley Coin","XUSD":"CoinoUSD","XXC":"CREDS","YACC":"YACCoin","YANG":"Yangcoin","YC":"YellowCoin","YIN":"Yincoin","XVC":"Vcash","FLO":"Florincoin","XEM":"NEM","ARCH":"ARCHcoin","HUGE":"BIGcoin","GRC":"Gridcoin Research","IOC":"IO Digital Currency","INDEX":"CoinoIndex","ETH":"Ethereum","SC":"Siacoin","BCY":"BitCrystals","EXP":"Expanse","FCT":"Factom","BITUSD":"BitUSD","BITCNY":"BitCNY","RADS":"Radium","AMP":"Synereo AMP","VOX":"Voxels","DCR":"Decred","LSK":"Lisk","DAO":"The DAO","LBC":"LBRY Credits","STEEM":"STEEM","SBD":"Steem Dollars","ETC":"Ethereum Classic","REP":"Augur","ARDR":"Ardor","ZEC":"Zcash","STRAT":"Stratis","NXC":"Nexium","PASC":"PascalCoin","GNT":"Golem","GNO":"Gnosis","BCH":"Bitcoin Cash","ZRX":"0x","CVC":"Civic","OMG":"OmiseGO","GAS":"Gas","MNS1":"Mining Shares"};
var primaryCurrency = 'BTC';
var secondaryCurrency = 'ETH';

var isLocal = false;

var userinfo = {};
var settingData = {thSetting: '_30m'};
var activeAuto = true;
var listPeriod = [300, 900, 1800, 7200, 14400, 86400];
var  allTickerData = {};



$.urlParam = function (name) {
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    return results[1] || 0;
}

if(localStorage.getItem("userinfo")){
    userinfo = JSON.parse(localStorage.getItem('userinfo'));
}
if(localStorage.getItem("settingData")){
    settingData = JSON.parse(localStorage.getItem("settingData"));
}


// When the user clicks the button, open the modal
$(document).on('click', '.pair-info button', function(){
    //$('#myModal').css('display', 'block') ;
    console.log($(this).attr('class'));
    var type = $(this).attr('class').split(' ')[2];
    var pair = settingData.selectedCurrencyPair;

    switch(type){
        case 'buy':

            break;
        case 'waiting-buy':
            if($('.pair-info .price-buy').val() == '' || parseFloat($('.pair-info .price-buy').val()) <= 0){
                alert('invalid price');
                return false;
            }
            if($('.pair-info .amount-buy').val() == '' || parseFloat($('.pair-info .amount-buy').val()) <= 0){
                alert('invalid amount');
                return false;
            }
            settingData[pair].watingBuy = {
                active : true,
                amount : parseFloat($('.pair-info .amount-buy').val()),
                price : parseFloat($('.pair-info .price-buy').val())
            };
            UpdateSettingData(settingData);
            alert('Add success');
            break;
        case 'sell':
            break;
        case 'waiting-sell':
            if($('.pair-info .price-sell').val() == '' || parseFloat($('.pair-info .price-sell').val()) <= 0){
                alert('invalid price');
                return false;
            }
            if($('.pair-info .amount-sell').val() == '' || parseFloat($('.pair-info .amount-sell').val()) <= 0){
                alert('invalid amount');
                return false;
            }
            settingData[pair].watingSell = {
                active : true,
                amount : parseFloat($('.pair-info .amount-sell').val()),
                price : parseFloat($('.pair-info .price-sell').val())
            };
            UpdateSettingData(settingData);
            alert('Add success');
            break;
    }
    UpdateBuySellData(pair);
});

// When the user clicks on <span> (x), close the modal
$(document).on('click', '#myModal .close', function(){
    $('#myModal').css('display', 'none') ;
});

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target.id == 'myModal') {
        $('#myModal').css('display', 'none') ;
    }
}










var UpdateSettingData = function(settingData){
    localStorage.setItem("settingData", JSON.stringify(settingData));
}

function UpdateBuySellData(pair){
    if(settingData[pair].watingBuy.active && settingData[pair].watingBuy.active == true){
        var text = 'price : ' + settingData[pair].watingBuy.price + ' - amount : ' + settingData[pair].watingBuy.amount;
        $('.waiting-buy-data').html(text);
    }else{
        $('.waiting-buy-data').html('');
    }
    if(settingData[pair].watingSell.active && settingData[pair].watingSell.active == true){
        var text = 'price : ' + settingData[pair].watingSell.price + ' - amount : ' + settingData[pair].watingSell.amount;
        $('.waiting-sell-data').html(text);
    }else{
        $('.waiting-sell-data').html('');
    }
}

function InitSettingData(){
    if(settingData.selectedCurrencyPair){
        var main = settingData.selectedCurrencyPair.split('_')[0];
        $("#container" + main).addClass("active");
        $('#baseTab' + main).addClass("active");
    }
    if(settingData.maSetting){
        $('.maSetting option').each(function(index,value){
            if($(this).val() == settingData.maSetting){
                $(this).attr('selected','selected');
            }
        })
    }
    if(settingData.thSetting){
        $('.thSetting option').each(function(index,value){
            if($(this).val() == settingData.thSetting){
                $(this).attr('selected','selected');
            }
        })
    }
    for (var i = 0; i < currencyPairArray.length; i++) {
        var pair = currencyPairArray[i];
        if(settingData[pair].auto && settingData[pair].auto == true){
            $('#marketRow' + pair.toLowerCase()).find('input.auto').prop('checked', true);
        }
        for(var k = 0; k < listPeriod.length; k++){
            var period = '_' + listPeriod[k];
            if(settingData[pair][period] && settingData[pair][period] == true){
                var friend = $('#marketRow' + pair.toLowerCase()).find('.' + period).eq(0);
                friend.parent().find('input').prop('checked', true);
            }
        }
    }

}

function GetMAText(str){
    var text = '';
    if(str[0] == 'U'){
        text += '<span style="color: #27892f;">U</span>';
    }
    if(str[0] == 'D'){
        text += '<span style="color: #c02a1d;">D</span>';
    }
    if(str[1] == 'H'){
        text += '<span style="color: #27892f;">H</span>';
    }
    if(str[1] == 'C'){
        text += '<span style="color: #f5b131;">C</span>';
    }
    if(str[1] == 'L'){
        text += '<span style="color: #c02a1d;">L</span>';
    }
    return text;
}

function refreshMA(){
    var name = settingData.maSetting;
    $('.marketRow').each(function(){
        var pair = $(this).attr('data-url').toUpperCase();
        $(this).find('.tbMa _300').html(GetMAText(totalData[pair]['_300'].curCandle.code[name]));
        $(this).find('.tbMa _900').html(GetMAText(totalData[pair]['_900'].curCandle.code[name]));
        $(this).find('.tbMa _1800').html(GetMAText(totalData[pair]['_1800'].curCandle.code[name]));
        $(this).find('.tbMa _7200').html(GetMAText(totalData[pair]['_7200'].curCandle.code[name]));
        $(this).find('.tbMa _14400').html(GetMAText(totalData[pair]['_14400'].curCandle.code[name]));
    })
}

function refreshTH(){
    $('.thVolume p').html('-');
    var name = settingData.thSetting;
    $('.marketRow').each(function(){
        var pair = $(this).attr('data-url').toUpperCase();
        $(this).find('.thVolume thBuy').html(totalData[pair].volumeBuy[name]);
        $(this).find('.thVolume thSell').html(totalData[pair].volumeSell[name]);
    })
}

function InitBalances (){
    $.ajax({
        url: '/api/postapipolo',
        data: {
            command: 'returnBalances',
            ApiKey: userinfo.userPoloApiKey,
            ApiSecret: userinfo.userPoloApiSecret
        },
        global: false,
        type: 'POST',
        async: false, //blocks window close
        success: function (result) {
            var data = JSON.parse(result.data);
            $(".dataTables_scrollBody tr.marketRow").each(function() {
                var abc = $(this).attr("data-url").split('_');
                var pair = abc[1].toUpperCase();
                $(this).find(".balances").html(data[pair]);
            });
            $("#balancesBTC").html(data['BTC']);
            $("#balancesETH").html(data['ETH']);
            $("#balancesXMR").html(data['XMR']);
            $("#balancesUSDT").html(data['USDT']);
        }
    });
}



function writeMarketTable(coin) {
    var arr = currencyPairArray.filter(function (d, i) {
        return (d.substr(0, coin.length) === coin);
    });

    var rows = '';
    for (var i = 0; i < arr.length; i++) {
        rows += getRow(arr[i]);
    }
    // console.log('#market' + coin + ' tbody');
    // console.log(rows);
    $('#market' + coin + ' tbody').html(rows);
    // $('#market' + coin).append('<tbody>' + rows + '</tbody>');
}

function getRow(pair) {
    var d = formatTickerData(pair, allTickerData[pair]);
    var active = '';
    var starOff = '';
    var starContents = '~';
    var pair = (primaryCurrency + '_' + secondaryCurrency).toLowerCase();
    if (d.url == pair) { active = ' active'; }

    // if this is marked as non-starred in settings
    // var starIndex = starSettings.indexOf(d.url.toUpperCase());
    // if (starIndex > -1) {
    //     starOff = ' starOff';
    //     starContents = '';
    // }

    var row = '<tr  data-url="' + d.url + '" id="marketRow' + d.url + '" class="marketRow ' + d.frozen + active + starOff + '">';
    // row += '<td class="star"><input class="auto" type="checkbox" name="' + d.url + '" /></td>';
    row += '<td class="coin"><a href="/market/exchange?currency=' + d.url.toUpperCase() +'" >' + d.secondary + '</a></td>';
    row += '<td class="colName"><div class="ellipsis" title="' + d.name + '">' + d.name + '</div></td>';
    if (!d.frozen) {
        row += '<td class="pricechange"><p class="price">' + d.price + '</p></td>'; //<p class="change">' + d.displayChange + '</p>
        row += '<td class="volume">' + d.volume + '</td>';
        row += '<td class="change ' + d.changeDirection + '">' + d.displayChange + '</td>';
    } else {
        row += '<td class="price">&nbsp;FROZEN</td>'; // nbsp is used to make FROZEN appear last in sorting order
        row += '<td class="volume"></td>';
        row += '<td class="change"></td>';
    };
    row += '<td class="balances" >' + d.high24hr + '</td>';
    row += '<td class="balances" >' + d.low24hr + '</td>';

    row += '</tr>';

    return row;
}

function formatTickerData(pair, tickerData) {
    // console.log('format ' + pair + ' : ',tickerData);
    var pairArray = pair.split("_"),
    	base = pairArray[0],
    	quote = pairArray[1],
        name = getName(quote),
        decimals;


    tickerData.url = pair.toLowerCase();
    tickerData.pair = pair;
    tickerData.primary = base;
    tickerData.secondary = quote;
    tickerData.symbol = quote;
    tickerData.balance = 0.0;
    tickerData.value = 0.0;

    //if (allBalances instanceof Object) {
    //    tickerData.balance = parseFloat(allBalances['balances'][quote]) + parseFloat(allBalances['onOrders'][quote]);
    //    tickerData.value = tickerData.balance * parseFloat(tickerData.highestBid);
    //}

    tickerData.balance = tickerData.balance.toFixed(4);
    tickerData.value = tickerData.value.toFixed(4);

    allTickerData[pair]['balance'] = tickerData.balance;
    allTickerData[pair]['value'] = tickerData.value;

    tickerData.price = tickerData.last;

    tickerData.volume = exactRound(tickerData.baseVolume, 3);
    tickerData.change = exactRound(tickerData.percentChange * 100, 2);
    tickerData.changeDirection = "positive";
    tickerData.displayChange = tickerData.change;
    tickerData.name = "";
    tickerData.class = "";

    if (name) {
        tickerData.name = name;
    }

    tickerData.frozen = '';
    if (tickerData.isFrozen === '1') {
        tickerData.frozen = 'frozen';
    }

    if (tickerData.change < 0) {
        tickerData.changeDirection = "neg";
    }
    else {
        tickerData.displayChange = '+' + tickerData.displayChange;
    }

    return tickerData;
}

function exactRound(num, decimals) {
    if (decimals < 0) decimals = 0;
    var sign = num >= 0 ? 1 : -1;
    return (Math.round((num * Math.pow(10, decimals)) + (sign * 0.001)) / Math.pow(10, decimals)).toFixed(decimals);
}

function getName(coin) {
    return currencyNamesArray[coin];
}

function InitDataTable() {
    var marketTablesLoaded = 0;
    var marketTableOptions = {
        // paging: false,
        bFilter: false,
        bLengthChange : false,
        autoWidth: true,
        //searching: false,
        info: false,
        //use datatables built in local storage function to save sort order and other table settings
        stateSave: true,
        // scrollY: 800,
        // scrollCollapse: true,
        order: [[3, 'desc']],
        language: { "emptyTable": "No markets item to display", "zeroRecords": "No markets item matching your filters" },
        // Set the sort on some columns to be descending on first click
        // If we add a new col to the table it needs to be defined here
        aoColumns: [
            { "asSorting": ["desc", "asc"] },
            { "asSorting": ["desc", "asc"] },
			{ "asSorting": ["desc", "asc"], "searchable": false },
			{ "asSorting": ["desc", "asc"], "searchable": false, "visible": true },
			{ "asSorting": ["desc", "asc"], "searchable": false },
			
			{ "asSorting": ["desc", "asc"], "searchable": false, "visible": true },
			{ "asSorting": ["desc", "asc"], "searchable": false, "visible": true },
            // { "visible": true },
            // { "bSortable" : false,"visible": true }
        ],
        fnInitComplete: function (oSettings, json) {
            marketTablesLoaded++;
        }
    };

    marketBTCTable = $('#marketBTC').dataTable(marketTableOptions);
    marketETHTable = $('#marketETH').dataTable(marketTableOptions);
    marketXMRTable = $('#marketXMR').dataTable(marketTableOptions);
    marketUSDTTable = $('#marketUSDT').dataTable(marketTableOptions);

    //Prevent Datatables from saving the search filter settings to local storage
    marketBTCTable.dataTable()
		.on('stateSaveParams.dt', function (e, settings, data) {
		    data.search.search = "";
		});
    marketETHTable.dataTable()
		.on('stateSaveParams.dt', function (e, settings, data) {
		    data.search.search = "";
		});
    marketXMRTable.dataTable()
		.on('stateSaveParams.dt', function (e, settings, data) {
		    data.search.search = "";
		});
    marketUSDTTable.dataTable()
		.on('stateSaveParams.dt', function (e, settings, data) {
		    data.search.search = "";
		});

}

function writeOrderbookTable(data, type){
    var id = 'buyOrders';
    if(type == 'sell'){
        id = 'sellOrders';
    }
    var sum = 0;
    for(var i = 0; i < data.length ; i++){
        var price = parseFloat(data[i][0]);
        var amount = parseFloat(data[i][1]);
        var total = price*amount;
        sum += total;

        var row = '<tr class="orderBookRow">';
        row += '<td class="prices" >' + price + '</td>';
        row += '<td class="amount" >' + amount + '</td>';
        row += '<td class="total" >' + total.toFixed(8) + '</td>';
        row += '<td class="sum" >' + sum.toFixed(8) + '</td>';
        row += '</tr>';

        $('#' + id).find('tbody').append(row);

    }
    $('#' + id).dataTable();

}

function writeTradeHistoryTable(data){
    for(var i = data.length - 1; i >= 0; i--){
        var row = '<tr class="orderBookRow">';
        row += '<td class="date" >' + data[i].date + '</td>';
        row += '<td class="type" >' + data[i].type + '</td>';
        row += '<td class="rate" >' + data[i].rate + '</td>';
        row += '<td class="amount" >' + data[i].amount + '</td>';
        row += '<td class="total" >' + data[i].total + '</td>';
        row += '</tr>';
        $('#tradeHistory tbody').append(row);
    }
    $('#tradeHistory').dataTable();
    
}